---
layout: guides
title: "Step 2: Generate a client token"
guide:
  step: 2
meta:
  title: Generating Tokens For Drop-in Components | Dwolla API Documentation
  description: Generate a client token or token URL for flow drop-in components.
---

# Step 2: Generate a client token

Regardless of which drop-in component is being used by your application, the dwolla-web.js JavaScript library will require a unique “client-token” or a server side route that is used to generate a client token to be passed in on [configuration](/guides/drop-ins/using-drop-in-components#configure-dwolla-webjs). A client token contains granular permissions and is scoped to the end-user/Customer that is performing the action within your web application.

Client-tokens are single-use tokens that are valid for up to 1 hour after being generated. More than one client token can be generated and be valid at one time.

## Token URL vs Token

The drop-in components have multiple isolated functions connected together into a single user flow. Throughout the flow of a component, the dwolla-web library will make multiple http calls to an endpoint you have set up on your server side for fetching client-tokens as needed.

There are two to configure your drop-ins components for fetching client-tokens -

- [Using Token URL](#using-token-url)
- [Using Token](#using-token)

### Using Token URL

Create a server-side `tokenUrl` endpoint that can be called by the dwolla-web library when an action needs to be performed within the flow. This is necessary and allows for fetching client-tokens as needed throughout the flow. This endpoint should simply act as a passthrough to the client-tokens endpoint. It takes in the request body and makes a client-token call. Upon success, it returns a JSON-encoded string token in the response. Then configure the drop-in to use the `tokenUrl` parameter and pass it your server-side URL. More information on configuration of dwolla-web.js can be found on [step 3](https://developers.dwolla.com/guides/drop-ins/using-drop-in-components#configure-dwolla-webjs).

#### Example of setting up a token endpoint server side using Express

In this example we’re using Express.js to set up a token URL which will be called by `dwolla-web.js` when the component that’s being used needs to generate a client token that’s being performed in the flow.

```javascript
/**
 * Using Dwolla Node.js SDK - https://github.com/Dwolla/dwolla-v2-node
 * Refer to Step 1 on setup and configuration of Dwolla SDK
 */

app.post("/tokenUrl", function (req, res) {
  generateClientTokenWithBody(req.body).then((clientTokenRes) => {
    console.log(clientTokenRes);
    res.send({ token: clientTokenRes.token });
  });
});

function generateClientTokenWithBody(body) {
  const url = `/client-tokens`;

  return dwolla
    .post(url, body)
    .then((response) => {
      return response.body;
    })
    .catch((error) => {
      return error;
    });
}
```

##### Example configuration using `tokenUrl`

```javascript
<script>
  dwolla.configure({
      environment: "sandbox",
      // styles: "/styles/create-custom.css",
      success: (res) => Promise.resolve(),
      error: (err) => Promise.resolve(),
      tokenUrl: "/tokenUrl",
  });
</script>
```

### Using Token

Create a function that calls your server-side `tokenUrl` endpoint and returns a promise containing a token. Then set up the configuration of the drop-in with a `token` parameter which calls that function. This allows passing custom headers when calling your server-side endpoint for added protection and authentication.

#### Example of setting up a function to call `tokenUrl` using Express

```javascript
function dwollaAPIToken(req, additional) {
  const tokenUrl = "/tokenUrl";
  const data = {
    action: req.action,
  };
  if (req.links) {
    data._links = req.links;
  }
  const headers = {
    Accept: "application/json",
    "Content-Type": "application/json",
    "X-Requested-With": "Dwolla-Drop-Ins-Library",
  };
  return fetch(`${tokenUrl}`, {
    credentials: "include",
    method: "POST",
    body: JSON.stringify(data),
    headers,
  })
    .then((response) => {
      return response.json();
    })
    .then((result) => {
      return result;
    })
    .catch((error) => {
      console.log(error);
      return error;
    });
}
```

##### Example configuration using `token`

```javascript
<script>
  dwolla.configure({
      environment: "sandbox",
      // styles: "/styles/create-custom.css",
      success: (res) => Promise.resolve(),
      error: (err) => Promise.resolve(),
      token: (req) => Promise.resolve(dwollaAPIToken(req, {blah: "abcd"})),
  });
</script>
```
